/**
 * @license jq-snap-puzzle v1.0.2
 * (c) 2018 Finsi, Inc.
 */

var SnapPuzzleEvents;!function(e){e.pieceDrop="snapPuzzle:pieceDrop",e.reset="snapPuzzle:reset",e.complete="snapPuzzle:complete"}(SnapPuzzleEvents||(SnapPuzzleEvents={}));class SnapPuzzlePiece{constructor(e){this.completed=!1,void 0!=e.puzzle&&(this.puzzle=e.puzzle),void 0!=e.pieceEl&&(this.pieceEl=e.pieceEl,this.pieceNativeEl=this.pieceEl.get(0)),void 0!=e.slotEl&&(this.slotEl=e.slotEl,this.slotNativeEl=this.slotEl.get(0)),void 0!=e.x&&(this.x=e.x),void 0!=e.y&&(this.y=e.y),this.slotEl.data(SnapPuzzlePiece.DATA_KEY,this),this.pieceEl.data(SnapPuzzlePiece.DATA_KEY,this),this.refresh(),this.initDraggable(),this.initDroppable()}refresh(){this.pieceEl.css({width:this.puzzle.pieceWidth,height:this.puzzle.pieceHeight,backgroundImage:"url("+this.puzzle.src+")",backgroundPosition:-this.x*this.puzzle.pieceWidth+"px "+-this.y*this.puzzle.pieceHeight+"px",backgroundSize:this.puzzle.imageWidth+"px "+this.puzzle.imageHeight+"px"}),this.slotEl.css({width:this.puzzle.pieceWidth,height:this.puzzle.pieceHeight,top:this.y*this.puzzle.pieceHeight,left:this.x*this.puzzle.pieceWidth}),this.puzzle.options.backgroundInSlots?this.slotEl.css({backgroundImage:"url("+this.puzzle.src+")",backgroundPosition:-this.x*this.puzzle.pieceWidth+"px "+-this.y*this.puzzle.pieceHeight+"px",backgroundSize:this.puzzle.imageWidth+"px "+this.puzzle.imageHeight+"px"}):this.slotEl.css({backgroundImage:"",backgroundPosition:"",backgroundSize:""}),void 0==this.pieceDroppedInto?this.puzzle.options.randomPieceStartPosition?this.pieceEl.css({left:Math.floor(Math.random()*(this.puzzle.piecesContainerEl.width()-this.pieceEl.width()+1)),top:Math.floor(Math.random()*(this.puzzle.piecesContainerEl.height()-this.pieceEl.height()+1))}):this.pieceEl.css({left:"",top:""}):void 0!=this.pieceDropped&&this.pieceDropped.pieceEl.position({my:"left top",at:"left top",of:this.slotEl,collision:"none"})}reset(){this.completed=!1,this.pieceDropped=null,this.pieceDroppedInto=null,this.refresh(),this.puzzle.options.disabled||this.enable()}solve(e=!0){this.completed||this.pieceEl.position({my:"left top",at:"left top",of:this.slotEl,collision:"none",using:(s,t)=>{this.pieceEl.addClass("ui-draggable-dragging");const i=this.pieceEl.css("zIndex");this.pieceEl.css("zIndex",i+1);let o=t.element.element.offset(),p=t.target.element.offset(),n=Math.sqrt(Math.pow(p.left-o.left,2)+Math.pow(p.top-o.top,2));this.pieceEl.animate({top:s.top,left:s.left},Math.min(2e3,2*n),()=>{this.pieceEl.removeClass("ui-draggable-dragging");this.onDrop({},{draggable:this.pieceEl},e)})}})}onDrop(e,s,t=!0){let i=s.draggable,o=i.get(0);if(!(void 0!=this.pieceDropped&&this.pieceDropped.pieceNativeEl!=o||0!=this.puzzle.options.onlyDropOnValid&&o!=this.pieceNativeEl)){const e=i.data(SnapPuzzlePiece.DATA_KEY);e.pieceDroppedInto&&(e.pieceDroppedInto.pieceDropped=null),e.pieceDroppedInto=this,this.pieceDropped=e,o==this.pieceNativeEl?(this.completed=!0,i.removeClass(this.puzzle.options.classes.pieceIncorrect).addClass(this.puzzle.options.classes.pieceCorrect),this.slotEl.removeClass(this.puzzle.options.classes.slotIncorrect).addClass(this.puzzle.options.classes.slotCorrect),this.slotEl.droppable("disable"),i.draggable("disable")):(i.removeClass(this.puzzle.options.classes.pieceCorrect).addClass(this.puzzle.options.classes.pieceIncorrect),this.slotEl.removeClass(this.puzzle.options.classes.slotCorrect).addClass(this.puzzle.options.classes.slotIncorrect)),i.position({my:"left top",at:"left top",of:this.slotEl,collision:"none",using:e=>{i.animate({top:e.top,left:e.left},200,()=>{i.css("zIndex","")})}}),t&&this.puzzle.element.trigger(SnapPuzzleEvents.pieceDrop,{instance:this.puzzle,piece:e,slot:this,isCorrect:this.completed})}}resolveRevert(e){let s=!1;if(e){let t=e.data(SnapPuzzlePiece.DATA_KEY);if(void 0==t||void 0==t.pieceDropped||t.pieceDropped.pieceNativeEl==this.pieceNativeEl)if(e.hasClass(this.puzzle.options.classes.slot))s=0==this.puzzle.options.onlyDropOnValid||e.get(0)==this.slotNativeEl;else if(e.is(this.puzzle.piecesContainerEl)){let t=this.pieceEl.get(0).getBoundingClientRect(),i=e.get(0).getBoundingClientRect();s=t.left>=i.left&&t.right<=i.right&&t.top>=i.top&&t.bottom<=i.bottom}}return s||this.onRevert(e),!s}onRevert(e){let s,t;if(this.completed?(t=this.puzzle.options.classes.pieceIncorrect,s=this.puzzle.options.classes.pieceCorrect):this.pieceDroppedInto?(s=this.puzzle.options.classes.pieceIncorrect,t=this.puzzle.options.classes.pieceCorrect):t=[this.puzzle.options.classes.pieceIncorrect,this.puzzle.options.classes.pieceCorrect],this.pieceEl.removeClass(t).addClass(s),e){let s,t,i=e.data(SnapPuzzlePiece.DATA_KEY);i&&(i.completed?(t=this.puzzle.options.classes.pieceIncorrect,s=this.puzzle.options.classes.pieceCorrect):i.pieceDropped?(s=this.puzzle.options.classes.pieceIncorrect,t=this.puzzle.options.classes.pieceCorrect):t=[this.puzzle.options.classes.pieceIncorrect,this.puzzle.options.classes.pieceCorrect],e.removeClass(t).addClass(s))}}onStart(e,s){this.pieceEl.removeClass([this.puzzle.options.classes.pieceIncorrect,this.puzzle.options.classes.pieceCorrect])}over(e,s){const t=s.draggable,i=t.get(0);void 0!=this.pieceDropped&&this.pieceDropped.pieceNativeEl!=i||(i==this.pieceNativeEl?(t.removeClass(this.puzzle.options.classes.pieceIncorrect).addClass(this.puzzle.options.classes.pieceCorrect),this.slotEl.removeClass(this.puzzle.options.classes.slotIncorrect).addClass(this.puzzle.options.classes.slotCorrect)):(t.removeClass(this.puzzle.options.classes.pieceCorrect).addClass(this.puzzle.options.classes.pieceIncorrect),this.slotEl.removeClass(this.puzzle.options.classes.slotCorrect).addClass(this.puzzle.options.classes.slotIncorrect)))}out(e,s){this.slotEl.removeClass([this.puzzle.options.classes.slotCorrect,this.puzzle.options.classes.slotIncorrect])}initDraggable(){this.pieceEl.draggable({start:this.onStart.bind(this),stack:"."+this.puzzle.options.classes.piece,containment:this.puzzle.wrapperEl,revert:this.resolveRevert.bind(this)})}initDroppable(){this.slotEl.on("."+this.puzzle.options.namespace,this.over.bind(this)),this.slotEl.droppable({out:this.out.bind(this),drop:this.onDrop.bind(this)}),this.puzzle.options.feedbackOnHover&&this.slotEl.on("dropover."+this.puzzle.options.namespace,this.over.bind(this))}enable(){this.completed||(this.slotEl.droppable("enable"),this.pieceEl.draggable("enable"))}disable(){this.slotEl.droppable("disable"),this.pieceEl.draggable("disable")}}SnapPuzzlePiece.DATA_KEY="snapPuzzlePiece";class SnapPuzzleGame{destroy(){this._destroy(),this._super()}disable(){this._super(),this.element.addClass(this.options.classes.disabled),this.wrapperEl.addClass(this.options.classes.disabled);for(let e of this.pieces)e.disable()}enable(){this._super(),this.element.removeClass(this.options.classes.disabled),this.wrapperEl.removeClass(this.options.classes.disabled);for(let e of this.pieces)e.enable()}refresh(){this._resolveDimensions();const e=this.pieces;for(let s of e)s.refresh()}solve(e){if(!0===e)for(let e of this.pieces)e.solve();else if("number"==typeof e){let s=this.pieces[e];s&&s.solve()}else{const e=Math.floor(Math.random()*this.pendingPieces.length),s=this.pendingPieces[e];s.solve()}}reset(e=!0){this.pendingPieces=this.pieces.concat([]),this.wrapperEl.removeClass(this.options.classes.completed),this.element.removeClass(this.options.classes.completed);let s=this.pieces;for(let e of s)e.reset();e&&this.element.trigger(SnapPuzzleEvents.reset)}_getCreateOptions(){return{columns:0,rows:0,namespace:"jq-snap-puzzle",classes:{root:"c-snap-puzzle__image",wrapper:"c-snap-puzzle",completed:"c-snap-puzzle--completed",disabled:"c-snap-puzzle--disabled",piecesContainer:"c-snap-puzzle__pieces-container",slotsContainer:"c-snap-puzzle__slots-container",piece:"c-snap-puzzle__piece",pieceIncorrect:"c-snap-puzzle__piece--incorrect",pieceCorrect:"c-snap-puzzle__piece--correct",pieceDisabled:"c-snap-puzzle__piece--disabled",slot:"c-snap-puzzle__slot",slotHasPiece:"c-snap-puzzle__slot--has-piece",slotIncorrect:"c-snap-puzzle__slot--incorrect",slotCorrect:"c-snap-puzzle__slot--correct",slotDisabled:"c-snap-puzzle__slot--disabled",feedbackOnHover:"c-snap-puzzle--feedback-on-hover",backgroundInSlots:"c-snap-puzzle--slots-background"},onlyDropOnValid:!1,feedbackOnHover:!0,backgroundInSlots:!0,randomPieceStartPosition:!0}}_destroy(){$(window).off("."+this.options.namespace),this.element.off("."+this.options.namespace),this.element.removeClass([this.options.classes.disabled,this.options.classes.root,this.options.classes.completed]),this.element.insertAfter(this.wrapperEl),this.wrapperEl.remove()}_setOptions(e){let s=!1,t=!1,i=!1;for(let o in e)switch(o){case"namespace":case"classes":i=!0;break;case"rows":case"columns":t=!0;break;case"onlyDropOnValid":case"feedbackOnHover":case"backgroundInSlots":case"randomPieceStartPosition":s=!0}i?(this._destroy(),this._super(e),this._create()):t?(this._super(e),this.pieces=[],this.reset(!1),this._construct()):s&&(this._super(e),this._applyClassModifiers(),this.refresh())}_createPiecesContainer(){return"function"==(typeof this.options.createPiecesContainer).toLowerCase()?this.options.createPiecesContainer.apply(this,arguments):$(`<div class="${this.options.classes.piecesContainer}"></div>`)}_createSlotsContainer(){return"function"==(typeof this.options.createSlotsContainer).toLowerCase()?this.options.createSlotsContainer.apply(this,arguments):$(`<div class="${this.options.classes.slotsContainer}"></div>`)}_createWrapper(){return"function"==(typeof this.options.createWrapper).toLowerCase()?this.options.createWrapper.apply(this,arguments):$(`<div></div>`)}_createPiece(e,s){return"function"==(typeof this.options.createPiece).toLowerCase()?this.options.createPiece.apply(this,arguments):$(`<div class="${this.options.classes.piece}"></div>`)}_createSlot(e,s){return"function"==(typeof this.options.createSlot).toLowerCase()?this.options.createSlot.apply(this,arguments):$(`<div class="${this.options.classes.slot}"></div>`)}_constructPiece(e,s){let t=this._createPiece(e,s),i=this._createSlot(e,s).attr("data-x",e).attr("data-y",s);return new SnapPuzzlePiece({puzzle:this,pieceEl:t,slotEl:i,x:e,y:s})}_applyClassModifiers(){this.options.feedbackOnHover?this.wrapperEl.addClass(this.options.classes.feedbackOnHover):this.wrapperEl.removeClass(this.options.classes.feedbackOnHover),this.options.backgroundInSlots?this.wrapperEl.addClass(this.options.classes.backgroundInSlots):this.wrapperEl.removeClass(this.options.classes.backgroundInSlots)}_create(){if(!this.element.is("img"))throw"[SnapPuzzleGame] The widget must be initialized for <img> elements";{let e=this.element.attr("src");this.src=e,this.element.addClass(this.options.classes.root),this.wrapperEl=this._createWrapper(),this.wrapperEl.addClass(this.options.classes.wrapper),this.piecesContainerEl=void 0!=this.options.appendPiecesTo?$(this.options.appendPiecesTo):this._createPiecesContainer(),this.slotsContainerEl=this._createSlotsContainer(),void 0==this.options.appendPiecesTo&&this.wrapperEl.append(this.piecesContainerEl),this.wrapperEl.append(this.slotsContainerEl),this.wrapperEl.insertAfter(this.element),this.slotsContainerEl.append(this.element),this.pieces=[],this.piecesMatrix=[],this._resolveDimensions(),this.imageWidth!=1/0&&0!=this.imageWidth&&this.imageHeight!=1/0&&0!=this.imageHeight?this._construct():this.element.one("load",this._construct.bind(this)),this.element.off(this.options.namespace).on(SnapPuzzleEvents.pieceDrop+"."+this.options.namespace,this._onPieceDrop.bind(this))}}_onResize(){this.refresh()}_onDrop(e,s){let t=s.draggable.data(SnapPuzzlePiece.DATA_KEY);t&&t.pieceDroppedInto&&(t.pieceDroppedInto.pieceDropped=null,t.pieceDroppedInto=null),s.draggable.removeClass([this.options.classes.pieceIncorrect,this.options.classes.pieceCorrect])}_resolveDimensions(){this.imageWidth=this.element.width()||this.options.width||0,this.imageHeight=this.element.height()||this.options.height||0,this.pieceWidth=this.imageWidth/this.options.columns,this.pieceHeight=this.imageHeight/this.options.rows}_construct(){let e=this.options.rows,s=this.options.columns,t=[],i=[],o=s*e;this._resolveDimensions(),this._applyClassModifiers();for(let o=0;o<e;o++){let e=[];for(let p=0;p<s;p++){let s=this._constructPiece(p,o);i.push(s.slotEl.get(0)),t.push(s.pieceEl.get(0)),e.push(s),this.pieces.push(s),s.slotEl.appendTo(this.slotsContainerEl)}this.piecesMatrix[o]=e}this.slotsEls&&(this.slotsEls.remove(),this.piecesEls.remove()),this.slotsEls=$(i),this.piecesEls=$(t),this.pendingPieces=this.pieces.concat([]);const p=this.pieces.concat([]);p.sort(()=>Math.floor(Math.random()*o));for(let e of p)e.pieceEl.appendTo(this.piecesContainerEl);this.piecesContainerEl.droppable({accept:"."+this.options.classes.piece,drop:this._onDrop.bind(this)}),this._throttleResize()}_onPieceDrop(e,s){if(s.isCorrect){const e=this.pendingPieces.indexOf(s.piece);-1!=e&&this.pendingPieces.splice(e,1)}0==this.pendingPieces.length&&this._complete()}_complete(){this.wrapperEl.addClass(this.options.classes.completed),this.element.addClass(this.options.classes.completed),this.element.trigger(SnapPuzzleEvents.complete,this)}_onNativeResize(){this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this._onResize.bind(this),200)}_throttleResize(){$(window).off("."+this.options.namespace).on(`resize.${this.options.namespace}`,this._onNativeResize.bind(this))}}if(Object.hasOwnProperty("getOwnPropertyDescriptors")){let e={},s=Object.getOwnPropertyNames(SnapPuzzleGame.prototype);for(let t=0,i=s.length;t<i;t++){let i=s[t];e[i]=Object.getOwnPropertyDescriptor(SnapPuzzleGame.prototype,i).value}$.widget("ui.snapPuzzle",e)}else $.widget("ui.snapPuzzle",SnapPuzzleGame.prototype);export{SnapPuzzleEvents,SnapPuzzlePiece,SnapPuzzleGame};
