/**
 * @license jq-snap-puzzle v1.1.1
 * (c) 2018 Finsi, Inc.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.jqSnapPuzzle={})}(this,function(e){"use strict";var t;(t=e.SnapPuzzleEvents||(e.SnapPuzzleEvents={})).pieceDrop="snapPuzzle:pieceDrop",t.reset="snapPuzzle:reset",t.complete="snapPuzzle:complete";var s=function(){function e(t){this.completed=!1,void 0!=t.puzzle&&(this.puzzle=t.puzzle),void 0!=t.pieceEl&&(this.pieceEl=t.pieceEl,this.pieceNativeEl=this.pieceEl.get(0)),void 0!=t.slotEl&&(this.slotEl=t.slotEl,this.slotNativeEl=this.slotEl.get(0)),void 0!=t.x&&(this.x=t.x),void 0!=t.y&&(this.y=t.y),this.slotEl.data(e.DATA_KEY,this),this.pieceEl.data(e.DATA_KEY,this),this.refresh(),this.initDraggable(),this.initDroppable()}return e.prototype.refresh=function(){this.pieceEl.css({width:this.puzzle.pieceWidth,height:this.puzzle.pieceHeight,backgroundImage:"url("+this.puzzle.src+")",backgroundPosition:-this.x*this.puzzle.pieceWidth+"px "+-this.y*this.puzzle.pieceHeight+"px",backgroundSize:this.puzzle.imageWidth+"px "+this.puzzle.imageHeight+"px"}),this.slotEl.css({width:this.puzzle.pieceWidth,height:this.puzzle.pieceHeight,top:this.y*this.puzzle.pieceHeight,left:this.x*this.puzzle.pieceWidth}),this.puzzle.options.backgroundInSlots?this.slotEl.css({backgroundImage:"url("+this.puzzle.src+")",backgroundPosition:-this.x*this.puzzle.pieceWidth+"px "+-this.y*this.puzzle.pieceHeight+"px",backgroundSize:this.puzzle.imageWidth+"px "+this.puzzle.imageHeight+"px"}):this.slotEl.css({backgroundImage:"",backgroundPosition:"",backgroundSize:""}),void 0==this.pieceDroppedInto?this.puzzle.options.randomPieceStartPosition?this.pieceEl.css({left:Math.floor(Math.random()*(this.puzzle.piecesContainerEl.width()-this.pieceEl.width()+1)),top:Math.floor(Math.random()*(this.puzzle.piecesContainerEl.height()-this.pieceEl.height()+1))}):this.pieceEl.css({left:"",top:""}):void 0!=this.pieceDropped&&this.pieceDropped.pieceEl.position({my:"left top",at:"left top",of:this.slotEl,collision:"none"})},e.prototype.reset=function(){this.completed=!1,this.pieceDropped=null,this.pieceDroppedInto=null,this.refresh(),this.puzzle.options.disabled||this.enable()},e.prototype.solve=function(e){var t=this;void 0===e&&(e={}),this.completed||this.pieceEl.position({my:"left top",at:"left top",of:this.slotEl,collision:"none",using:function(s,i){t.pieceEl.addClass("ui-draggable-dragging");var o=t.pieceEl.css("zIndex");t.pieceEl.css("zIndex",o+1);var p=i.element.element.offset(),n=i.target.element.offset(),l=Math.sqrt(Math.pow(n.left-p.left,2)+Math.pow(n.top-p.top,2));t.pieceEl.animate({top:s.top,left:s.left},0!=e.animate?Math.min(2e3,2*l):0,function(){t.pieceEl.removeClass("ui-draggable-dragging"),t.onDrop({},{draggable:t.pieceEl},0!=e.emitChange)})}})},e.prototype.onDrop=function(t,s,i){void 0===i&&(i=!0);var o=s.draggable,p=o.get(0);if(!(void 0!=this.pieceDropped&&this.pieceDropped.pieceNativeEl!=p||0!=this.puzzle.options.onlyDropOnValid&&p!=this.pieceNativeEl)){var n=o.data(e.DATA_KEY);n.pieceDroppedInto&&(n.pieceDroppedInto.pieceDropped=null),n.pieceDroppedInto=this,this.pieceDropped=n,p==this.pieceNativeEl?(this.completed=!0,o.removeClass(this.puzzle.options.classes.pieceIncorrect).addClass(this.puzzle.options.classes.pieceCorrect),this.slotEl.removeClass(this.puzzle.options.classes.slotIncorrect).addClass(this.puzzle.options.classes.slotCorrect),this.slotEl.droppable("disable"),o.draggable("disable")):(o.removeClass(this.puzzle.options.classes.pieceCorrect).addClass(this.puzzle.options.classes.pieceIncorrect),this.slotEl.removeClass(this.puzzle.options.classes.slotCorrect).addClass(this.puzzle.options.classes.slotIncorrect)),o.position({my:"left top",at:"left top",of:this.slotEl,collision:"none",using:function(e){o.animate({top:e.top,left:e.left},200,function(){o.css("zIndex","")})}}),this.puzzle._onPieceDrop({instance:this.puzzle,piece:n,slot:this,isCorrect:this.completed},i)}},e.prototype.resolveRevert=function(t){var s=!1;if(t){var i=t.data(e.DATA_KEY);if(void 0==i||void 0==i.pieceDropped||i.pieceDropped.pieceNativeEl==this.pieceNativeEl)if(t.hasClass(this.puzzle.options.classes.slot))s=0==this.puzzle.options.onlyDropOnValid||t.get(0)==this.slotNativeEl;else if(t.is(this.puzzle.piecesContainerEl)){var o=this.pieceEl.get(0).getBoundingClientRect(),p=t.get(0).getBoundingClientRect();s=o.left>=p.left&&o.right<=p.right&&o.top>=p.top&&o.bottom<=p.bottom}}return s||this.onRevert(t),!s},e.prototype.onRevert=function(t){var s,i;if(this.completed?(i=this.puzzle.options.classes.pieceIncorrect,s=this.puzzle.options.classes.pieceCorrect):this.pieceDroppedInto?(s=this.puzzle.options.classes.pieceIncorrect,i=this.puzzle.options.classes.pieceCorrect):i=[this.puzzle.options.classes.pieceIncorrect,this.puzzle.options.classes.pieceCorrect],this.pieceEl.removeClass(i).addClass(s),t){var o=t.data(e.DATA_KEY),p=void 0,n=void 0;o&&(o.completed?(n=this.puzzle.options.classes.pieceIncorrect,p=this.puzzle.options.classes.pieceCorrect):o.pieceDropped?(p=this.puzzle.options.classes.pieceIncorrect,n=this.puzzle.options.classes.pieceCorrect):n=[this.puzzle.options.classes.pieceIncorrect,this.puzzle.options.classes.pieceCorrect],t.removeClass(n).addClass(p))}},e.prototype.onStart=function(e,t){this.pieceEl.removeClass([this.puzzle.options.classes.pieceIncorrect,this.puzzle.options.classes.pieceCorrect])},e.prototype.over=function(e,t){var s=t.draggable,i=s.get(0);void 0!=this.pieceDropped&&this.pieceDropped.pieceNativeEl!=i||(i==this.pieceNativeEl?(s.removeClass(this.puzzle.options.classes.pieceIncorrect).addClass(this.puzzle.options.classes.pieceCorrect),this.slotEl.removeClass(this.puzzle.options.classes.slotIncorrect).addClass(this.puzzle.options.classes.slotCorrect)):(s.removeClass(this.puzzle.options.classes.pieceCorrect).addClass(this.puzzle.options.classes.pieceIncorrect),this.slotEl.removeClass(this.puzzle.options.classes.slotCorrect).addClass(this.puzzle.options.classes.slotIncorrect)))},e.prototype.out=function(e,t){this.slotEl.removeClass([this.puzzle.options.classes.slotCorrect,this.puzzle.options.classes.slotIncorrect])},e.prototype.initDraggable=function(){this.pieceEl.draggable({start:this.onStart.bind(this),stack:"."+this.puzzle.options.classes.piece,containment:this.puzzle.wrapperEl,revert:this.resolveRevert.bind(this)})},e.prototype.initDroppable=function(){this.slotEl.on("."+this.puzzle.options.namespace,this.over.bind(this)),this.slotEl.droppable({out:this.out.bind(this),drop:this.onDrop.bind(this)}),this.puzzle.options.feedbackOnHover&&this.slotEl.on("dropover."+this.puzzle.options.namespace,this.over.bind(this))},e.prototype.enable=function(){this.completed||(this.slotEl.droppable("enable"),this.pieceEl.draggable("enable"))},e.prototype.disable=function(){this.slotEl.droppable("disable"),this.pieceEl.draggable("disable")},e.DATA_KEY="snapPuzzlePiece",e}(),i=function(){function t(){}return t.prototype.destroy=function(){this._destroy(),this._super()},t.prototype.disable=function(){this._super(),this.element.addClass(this.options.classes.disabled),this.wrapperEl.addClass(this.options.classes.disabled);for(var e=0,t=this.pieces;e<t.length;e++){t[e].disable()}},t.prototype.enable=function(){this._super(),this.element.removeClass(this.options.classes.disabled),this.wrapperEl.removeClass(this.options.classes.disabled);for(var e=0,t=this.pieces;e<t.length;e++){t[e].enable()}},t.prototype.refresh=function(){this._resolveDimensions();for(var e=0,t=this.pieces;e<t.length;e++){t[e].refresh()}},t.prototype.solve=function(e,t){if(!0===e)for(var s=0,i=this.pieces;s<i.length;s++){i[s].solve(t)}else if("number"==typeof e){(o=this.pieces[e])&&o.solve(t)}else{var o,p=Math.floor(Math.random()*this.pendingPieces.length);(o=this.pendingPieces[p]).solve(t)}},t.prototype.reset=function(t){void 0===t&&(t=!0),this.pendingPieces=this.pieces.concat([]),this.wrapperEl.removeClass(this.options.classes.completed),this.element.removeClass(this.options.classes.completed);for(var s=0,i=this.pieces;s<i.length;s++){i[s].reset()}t&&this.element.trigger(e.SnapPuzzleEvents.reset)},t.prototype._getCreateOptions=function(){return{columns:0,rows:0,namespace:"jq-snap-puzzle",classes:{root:"c-snap-puzzle__image",wrapper:"c-snap-puzzle",completed:"c-snap-puzzle--completed",disabled:"c-snap-puzzle--disabled",piecesContainer:"c-snap-puzzle__pieces-container",slotsContainer:"c-snap-puzzle__slots-container",piece:"c-snap-puzzle__piece",pieceIncorrect:"c-snap-puzzle__piece--incorrect",pieceCorrect:"c-snap-puzzle__piece--correct",pieceDisabled:"c-snap-puzzle__piece--disabled",slot:"c-snap-puzzle__slot",slotHasPiece:"c-snap-puzzle__slot--has-piece",slotIncorrect:"c-snap-puzzle__slot--incorrect",slotCorrect:"c-snap-puzzle__slot--correct",slotDisabled:"c-snap-puzzle__slot--disabled",feedbackOnHover:"c-snap-puzzle--feedback-on-hover",backgroundInSlots:"c-snap-puzzle--slots-background"},onlyDropOnValid:!1,feedbackOnHover:!0,backgroundInSlots:!0,randomPieceStartPosition:!0}},t.prototype._destroy=function(){$(window).off("."+this.options.namespace),this.element.off("."+this.options.namespace),this.element.removeClass([this.options.classes.disabled,this.options.classes.root,this.options.classes.completed]),this.element.insertAfter(this.wrapperEl),this.wrapperEl.remove()},t.prototype._setOptions=function(e){var t=!1,s=!1,i=!1;for(var o in e)switch(o){case"namespace":case"classes":i=!0;break;case"rows":case"columns":s=!0;break;case"onlyDropOnValid":case"feedbackOnHover":case"backgroundInSlots":case"randomPieceStartPosition":t=!0}i?(this._destroy(),this._super(e),this._create()):s?(this._super(e),this.pieces=[],this.reset(!1),this._construct()):t&&(this._super(e),this._applyClassModifiers(),this.refresh())},t.prototype._createPiecesContainer=function(){return"function"==(typeof this.options.createPiecesContainer).toLowerCase()?this.options.createPiecesContainer.apply(this,arguments):$('<div class="'+this.options.classes.piecesContainer+'"></div>')},t.prototype._createSlotsContainer=function(){return"function"==(typeof this.options.createSlotsContainer).toLowerCase()?this.options.createSlotsContainer.apply(this,arguments):$('<div class="'+this.options.classes.slotsContainer+'"></div>')},t.prototype._createWrapper=function(){return"function"==(typeof this.options.createWrapper).toLowerCase()?this.options.createWrapper.apply(this,arguments):$("<div></div>")},t.prototype._createPiece=function(e,t){return"function"==(typeof this.options.createPiece).toLowerCase()?this.options.createPiece.apply(this,arguments):$('<div class="'+this.options.classes.piece+'"></div>')},t.prototype._createSlot=function(e,t){return"function"==(typeof this.options.createSlot).toLowerCase()?this.options.createSlot.apply(this,arguments):$('<div class="'+this.options.classes.slot+'"></div>')},t.prototype._constructPiece=function(e,t){var i=this._createPiece(e,t),o=this._createSlot(e,t).attr("data-x",e).attr("data-y",t);return new s({puzzle:this,pieceEl:i,slotEl:o,x:e,y:t})},t.prototype._applyClassModifiers=function(){this.options.feedbackOnHover?this.wrapperEl.addClass(this.options.classes.feedbackOnHover):this.wrapperEl.removeClass(this.options.classes.feedbackOnHover),this.options.backgroundInSlots?this.wrapperEl.addClass(this.options.classes.backgroundInSlots):this.wrapperEl.removeClass(this.options.classes.backgroundInSlots)},t.prototype._create=function(){if(!this.element.is("img"))throw"[SnapPuzzleGame] The widget must be initialized for <img> elements";var e=this.element.attr("src");this.src=e,this.element.addClass(this.options.classes.root),this.wrapperEl=this._createWrapper(),this.wrapperEl.addClass(this.options.classes.wrapper),this.piecesContainerEl=void 0!=this.options.appendPiecesTo?$(this.options.appendPiecesTo):this._createPiecesContainer(),this.slotsContainerEl=this._createSlotsContainer(),void 0==this.options.appendPiecesTo&&this.wrapperEl.append(this.piecesContainerEl),this.wrapperEl.append(this.slotsContainerEl),this.wrapperEl.insertAfter(this.element),this.slotsContainerEl.append(this.element),this.pieces=[],this.piecesMatrix=[],this._resolveDimensions(),this.imageWidth!=1/0&&0!=this.imageWidth&&this.imageHeight!=1/0&&0!=this.imageHeight?this._construct():this.element.one("load",this._construct.bind(this))},t.prototype._onResize=function(){this.refresh()},t.prototype._onDrop=function(e,t){var i=t.draggable.data(s.DATA_KEY);i&&i.pieceDroppedInto&&(i.pieceDroppedInto.pieceDropped=null,i.pieceDroppedInto=null),t.draggable.removeClass([this.options.classes.pieceIncorrect,this.options.classes.pieceCorrect])},t.prototype._resolveDimensions=function(){this.imageWidth=this.element.width()||this.options.width||0,this.imageHeight=this.element.height()||this.options.height||0,this.pieceWidth=this.imageWidth/this.options.columns,this.pieceHeight=this.imageHeight/this.options.rows},t.prototype._construct=function(){var e=this.options.rows,t=this.options.columns,s=[],i=[],o=t*e;this._resolveDimensions(),this._applyClassModifiers();for(var p=0;p<e;p++){for(var n=[],l=0;l<t;l++){var r=this._constructPiece(l,p);i.push(r.slotEl.get(0)),s.push(r.pieceEl.get(0)),n.push(r),this.pieces.push(r),r.slotEl.appendTo(this.slotsContainerEl)}this.piecesMatrix[p]=n}this.slotsEls&&(this.slotsEls.remove(),this.piecesEls.remove()),this.slotsEls=$(i),this.piecesEls=$(s),this.pendingPieces=this.pieces.concat([]);var a=this.pieces.concat([]);a.sort(function(){return Math.floor(Math.random()*o)});for(var c=0,h=a;c<h.length;c++){(r=h[c]).pieceEl.appendTo(this.piecesContainerEl)}if(this.piecesContainerEl.droppable({accept:"."+this.options.classes.piece,drop:this._onDrop.bind(this)}),this.options.hints&&this.options.hints>0)for(var d=0;d<this.options.hints;d++)this.solve(null,{emitChange:!1,animate:!1});this._throttleResize()},t.prototype._onPieceDrop=function(t,s){if(void 0===s&&(s=!0),t.isCorrect){var i=this.pendingPieces.indexOf(t.piece);-1!=i&&this.pendingPieces.splice(i,1)}0!=s&&this.element.trigger(e.SnapPuzzleEvents.pieceDrop,t),0==this.pendingPieces.length&&this._complete()},t.prototype._complete=function(){this.wrapperEl.addClass(this.options.classes.completed),this.element.addClass(this.options.classes.completed),this.element.trigger(e.SnapPuzzleEvents.complete,this)},t.prototype._onNativeResize=function(){this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this._onResize.bind(this),200)},t.prototype._throttleResize=function(){$(window).off("."+this.options.namespace).on("resize."+this.options.namespace,this._onNativeResize.bind(this))},t}();if(Object.hasOwnProperty("getOwnPropertyDescriptors")){for(var o={},p=Object.getOwnPropertyNames(i.prototype),n=0,l=p.length;n<l;n++){var r=p[n];o[r]=Object.getOwnPropertyDescriptor(i.prototype,r).value}$.widget("ui.snapPuzzle",o)}else $.widget("ui.snapPuzzle",i.prototype);e.SnapPuzzlePiece=s,e.SnapPuzzleGame=i,Object.defineProperty(e,"__esModule",{value:!0})});
