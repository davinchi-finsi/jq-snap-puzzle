/**
 * @license jq-snap-puzzle v0.0.1
 * (c) 2018 Finsi, Inc.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e.$=e.$||{},e.$["snap-puzzle"]={}))}(this,function(e){"use strict";var t,s=function(){return function(){}}();(t=e.SnapPuzzleEvents||(e.SnapPuzzleEvents={})).pieceDrop="snapPuzzle:pieceDrop",t.reset="snapPuzzle:reset",t.completed="snapPuzzle:end";var i=function(){function t(e){this.completed=!1,null!=e.puzzle&&(this.puzzle=e.puzzle),null!=e.pieceEl&&(this.pieceEl=e.pieceEl,this.pieceNativeEl=this.pieceEl.get(0)),null!=e.slotEl&&(this.slotEl=e.slotEl,this.slotNativeEl=this.slotEl.get(0)),null!=e.x&&(this.x=e.x),null!=e.y&&(this.y=e.y),this.slotEl.data(t.DATA_KEY,this),this.pieceEl.data(t.DATA_KEY,this),this.refresh(),this.initDraggable(),this.initDroppable()}return t.prototype.refresh=function(){this.pieceEl.css({width:this.puzzle.pieceWidth,height:this.puzzle.pieceHeight,backgroundImage:"url("+this.puzzle.src+")",backgroundPosition:-this.x*this.puzzle.pieceWidth+"px "+-this.y*this.puzzle.pieceHeight+"px",backgroundSize:this.puzzle.imageWidth+"px "+this.puzzle.imageHeight+"px"}),this.slotEl.css({width:this.puzzle.pieceWidth,height:this.puzzle.pieceHeight,top:this.y*this.puzzle.pieceHeight,left:this.x*this.puzzle.pieceWidth}),this.puzzle.options.backgroundInSlots&&this.slotEl.css({backgroundImage:"url("+this.puzzle.src+")",backgroundPosition:-this.x*this.puzzle.pieceWidth+"px "+-this.y*this.puzzle.pieceHeight+"px",backgroundSize:this.puzzle.imageWidth+"px "+this.puzzle.imageHeight+"px"}),null==this.pieceDroppedInto?this.puzzle.options.randomPieceStartPosition?this.pieceEl.css({left:Math.floor(Math.random()*(this.puzzle.piecesContainerEl.width()-this.pieceEl.width()+1)),top:Math.floor(Math.random()*(this.puzzle.piecesContainerEl.height()-this.pieceEl.height()+1))}):this.pieceEl.css({left:"",top:""}):null!=this.pieceDropped&&this.pieceDropped.pieceEl.position({my:"left top",at:"left top",of:this.slotEl,collision:"none"})},t.prototype.reset=function(){this.completed=!1,this.pieceDropped=null,this.pieceDroppedInto=null,this.refresh(),this.puzzle.options.disabled||this.enable()},t.prototype.onDrop=function(s,i){var o=i.draggable,p=o.get(0);if(!(null!=this.pieceDropped&&this.pieceDropped.pieceNativeEl!=p||0!=this.puzzle.options.onlyDropOnValid&&p!=this.pieceNativeEl)){var l=o.data(t.DATA_KEY);l.pieceDroppedInto&&(l.pieceDroppedInto.pieceDropped=null),l.pieceDroppedInto=this,this.pieceDropped=l,p==this.pieceNativeEl?(this.completed=!0,o.removeClass(this.puzzle.options.classes.pieceIncorrect).addClass(this.puzzle.options.classes.pieceCorrect),this.slotEl.removeClass(this.puzzle.options.classes.slotIncorrect).addClass(this.puzzle.options.classes.slotCorrect),this.slotEl.droppable("disable"),o.draggable("disable")):(o.removeClass(this.puzzle.options.classes.pieceCorrect).addClass(this.puzzle.options.classes.pieceIncorrect),this.slotEl.removeClass(this.puzzle.options.classes.slotCorrect).addClass(this.puzzle.options.classes.slotIncorrect)),o.position({my:"left top",at:"left top",of:this.slotEl,collision:"none"}),this.puzzle.element.trigger(e.SnapPuzzleEvents.pieceDrop,{instance:this.puzzle,piece:l,slot:this,isCorrect:this.completed})}},t.prototype.resolveRevert=function(e){var s=!1;if(e){var i=e.data(t.DATA_KEY);if(null==i||null==i.pieceDropped||i.pieceDropped.pieceNativeEl==this.pieceNativeEl)if(e.hasClass(this.puzzle.options.classes.slot))s=0==this.puzzle.options.onlyDropOnValid||e.get(0)==this.slotNativeEl;else if(e.is(this.puzzle.piecesContainerEl)){var o=this.pieceEl.get(0).getBoundingClientRect(),p=e.get(0).getBoundingClientRect();s=o.left>=p.left&&o.right<=p.right&&o.top>=p.top&&o.bottom<=p.bottom}}return s||this.onRevert(e),!s},t.prototype.onRevert=function(e){var s,i;if(this.completed?(i=this.puzzle.options.classes.pieceIncorrect,s=this.puzzle.options.classes.pieceCorrect):this.pieceDroppedInto?(s=this.puzzle.options.classes.pieceIncorrect,i=this.puzzle.options.classes.pieceCorrect):i=[this.puzzle.options.classes.pieceIncorrect,this.puzzle.options.classes.pieceCorrect],this.pieceEl.removeClass(i).addClass(s),e){var o=e.data(t.DATA_KEY),p=void 0,l=void 0;o&&(o.completed?(l=this.puzzle.options.classes.pieceIncorrect,p=this.puzzle.options.classes.pieceCorrect):o.pieceDropped?(p=this.puzzle.options.classes.pieceIncorrect,l=this.puzzle.options.classes.pieceCorrect):l=[this.puzzle.options.classes.pieceIncorrect,this.puzzle.options.classes.pieceCorrect],e.removeClass(l).addClass(p))}},t.prototype.onStart=function(e,t){this.pieceEl.removeClass([this.puzzle.options.classes.pieceIncorrect,this.puzzle.options.classes.pieceCorrect])},t.prototype.over=function(e,t){var s=t.draggable,i=s.get(0);null!=this.pieceDropped&&this.pieceDropped.pieceNativeEl!=i||(i==this.pieceNativeEl?(s.removeClass(this.puzzle.options.classes.pieceIncorrect).addClass(this.puzzle.options.classes.pieceCorrect),this.slotEl.removeClass(this.puzzle.options.classes.slotIncorrect).addClass(this.puzzle.options.classes.slotCorrect)):(s.removeClass(this.puzzle.options.classes.pieceCorrect).addClass(this.puzzle.options.classes.pieceIncorrect),this.slotEl.removeClass(this.puzzle.options.classes.slotCorrect).addClass(this.puzzle.options.classes.slotIncorrect)))},t.prototype.out=function(e,t){this.slotEl.removeClass([this.puzzle.options.classes.slotCorrect,this.puzzle.options.classes.slotIncorrect])},t.prototype.initDraggable=function(){this.pieceEl.draggable({start:this.onStart.bind(this),stack:"."+this.puzzle.options.classes.piece,containment:this.puzzle.wrapperEl,revert:this.resolveRevert.bind(this)})},t.prototype.initDroppable=function(){this.slotEl.on("."+this.puzzle.options.namespace,this.over.bind(this)),this.slotEl.droppable({out:this.out.bind(this),drop:this.onDrop.bind(this)}),this.puzzle.options.feedbackOnHover&&this.slotEl.on("dropover."+this.puzzle.options.namespace,this.over.bind(this))},t.prototype.enable=function(){this.completed||(this.slotEl.droppable("enable"),this.pieceEl.draggable("enable"))},t.prototype.disable=function(){this.slotEl.droppable("disable"),this.pieceEl.draggable("disable")},t.DATA_KEY="snapPuzzleSlot",t}(),o=function(){function t(){}return t.prototype.destroy=function(){this.element.removeClass([this.options.classes.disabled,this.options.classes.root,this.options.classes.completed]),this.element.off("."+this.options.namespace),this.element.insertAfter(this.wrapperEl),this.wrapperEl.remove(),this._super()},t.prototype.disable=function(){this._super(),this.element.addClass(this.options.classes.disabled),this.wrapperEl.addClass(this.options.classes.disabled);for(var e=0,t=this.pieces;e<t.length;e++){t[e].disable()}},t.prototype.enable=function(){this._super(),this.element.removeClass(this.options.classes.disabled),this.wrapperEl.removeClass(this.options.classes.disabled);for(var e=0,t=this.pieces;e<t.length;e++){t[e].enable()}},t.prototype.refresh=function(){this._resolveDimensions();for(var e=0,t=this.pieces;e<t.length;e++){t[e].refresh()}},t.prototype.reset=function(){this.completed=0,this.wrapperEl.removeClass(this.options.classes.completed),this.element.removeClass(this.options.classes.completed);for(var t=0,s=this.pieces;t<s.length;t++){s[t].reset()}this.element.trigger(e.SnapPuzzleEvents.reset)},t.prototype._getCreateOptions=function(){return{columns:0,rows:0,namespace:"jq-snap-puzzle",classes:{root:"c-snap-puzzle__image",wrapper:"c-snap-puzzle",completed:"c-snap-puzzle--completed",disabled:"c-snap-puzzle--disabled",piecesContainer:"c-snap-puzzle__pieces-container",slotsContainer:"c-snap-puzzle__slots-container",piece:"c-snap-puzzle__piece",pieceIncorrect:"c-snap-puzzle__piece--incorrect",pieceCorrect:"c-snap-puzzle__piece--correct",pieceDisabled:"c-snap-puzzle__piece--disabled",slot:"c-snap-puzzle__slot",slotHasPiece:"c-snap-puzzle__slot--has-piece",slotIncorrect:"c-snap-puzzle__slot--incorrect",slotCorrect:"c-snap-puzzle__slot--correct",slotDisabled:"c-snap-puzzle__slot--disabled"},onlyDropOnValid:!1,feedbackOnHover:!0,backgroundInSlots:!0,randomPieceStartPosition:!0}},t.prototype._createPiecesContainer=function(){return"function"==(typeof this.options.createPiecesContainer).toLowerCase()?this.options.createPiecesContainer.apply(this,arguments):$('<div class="'+this.options.classes.piecesContainer+'"></div>')},t.prototype._createSlotsContainer=function(){return"function"==(typeof this.options.createSlotsContainer).toLowerCase()?this.options.createSlotsContainer.apply(this,arguments):$('<div class="'+this.options.classes.slotsContainer+'"></div>')},t.prototype._createWrapper=function(){return"function"==(typeof this.options.createWrapper).toLowerCase()?this.options.createWrapper.apply(this,arguments):$("<div></div>")},t.prototype._createPiece=function(e,t){return"function"==(typeof this.options.createPiece).toLowerCase()?this.options.createPiece.apply(this,arguments):$('<div class="'+this.options.classes.piece+'"></div>')},t.prototype._createSlot=function(e,t){return"function"==(typeof this.options.createSlot).toLowerCase()?this.options.createSlot.apply(this,arguments):$('<div class="'+this.options.classes.slot+'"></div>')},t.prototype._constructPiece=function(e,t){var s=this._createPiece(e,t),o=this._createSlot(e,t).attr("data-x",e).attr("data-y",t);return new i({puzzle:this,pieceEl:s,slotEl:o,x:e,y:t})},t.prototype._create=function(){if(!this.element.is("img"))throw"[SnapPuzzleGame] The widget must be initialized for <img> elements";var t=this.element.attr("src");this.src=t,this.element.addClass(this.options.classes.root),this.wrapperEl=this._createWrapper(),this.wrapperEl.addClass(this.options.classes.wrapper),this.piecesContainerEl=null!=this.options.appendPiecesTo?$(this.options.appendPiecesTo):this._createPiecesContainer(),this.slotsContainerEl=this._createSlotsContainer(),null==this.options.appendPiecesTo&&this.wrapperEl.append(this.piecesContainerEl),this.wrapperEl.append(this.slotsContainerEl),this.wrapperEl.insertAfter(this.element),this.slotsContainerEl.append(this.element),this.pieces=[],this.piecesMatrix=[],this.completed=0,this._resolveDimensions(),this.imageWidth!=1/0&&0!=this.imageWidth&&this.imageHeight!=1/0&&0!=this.imageHeight?this._onImageLoaded():this.element.one("load",this._onImageLoaded.bind(this)),this.element.on(e.SnapPuzzleEvents.pieceDrop,this._onPieceDrop.bind(this))},t.prototype._onResize=function(){this.refresh()},t.prototype._onDrop=function(e,t){var s=t.draggable.data(i.DATA_KEY);s&&s.pieceDroppedInto&&(s.pieceDroppedInto.pieceDropped=null,s.pieceDroppedInto=null),t.draggable.removeClass([this.options.classes.pieceIncorrect,this.options.classes.pieceCorrect])},t.prototype._resolveDimensions=function(){this.imageWidth=this.element.width()||this.options.width||0,this.imageHeight=this.element.height()||this.options.height||0,this.pieceWidth=this.imageWidth/this.options.columns,this.pieceHeight=this.imageHeight/this.options.rows},t.prototype._onImageLoaded=function(){var e=this.options.rows,t=this.options.columns,s=[],i=[],o=t*e;this._resolveDimensions();for(var p=0;p<e;p++){for(var l=[],n=0;n<t;n++){var r=this._constructPiece(n,p);i.push(r.slotEl.get(0)),s.push(r.pieceEl.get(0)),l.push(r),this.pieces.push(r),r.slotEl.appendTo(this.slotsContainerEl)}this.piecesMatrix[p]=l}this.slotsEls=$(i),this.piecesEls=$(s),this.pieces.sort(function(){return Math.floor(Math.random()*o)});for(var c=0,a=this.pieces;c<a.length;c++){(r=a[c]).pieceEl.appendTo(this.piecesContainerEl)}this.piecesContainerEl.droppable({accept:"."+this.options.classes.piece,drop:this._onDrop.bind(this)}),this._throttleResize()},t.prototype._onPieceDrop=function(e,t){t.isCorrect&&this.completed++,this.completed==this.pieces.length&&this._complete()},t.prototype._complete=function(){this.wrapperEl.addClass(this.options.classes.completed),this.element.addClass(this.options.classes.completed),this.element.trigger(e.SnapPuzzleEvents.completed,this)},t.prototype._onNativeResize=function(){this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this._onResize.bind(this),200)},t.prototype._throttleResize=function(){$(window).on("resize",this._onNativeResize.bind(this))},t}();if(Object.hasOwnProperty("getOwnPropertyDescriptors")){for(var p={},l=Object.getOwnPropertyNames(o.prototype),n=0,r=l.length;n<r;n++){var c=l[n];p[c]=Object.getOwnPropertyDescriptor(o.prototype,c).value}$.widget("ui.snapPuzzle",p)}else $.widget("ui.snapPuzzle",o);e.SnapPuzzleOptions=s,e.SnapPuzzlePiece=i,e.SnapPuzzleGame=o,Object.defineProperty(e,"__esModule",{value:!0})});
